test_data = [{
    "sr_location" : "1800 VALLEJO ST, AUSTIN, TX 78757",
    "sr_location_council_district" : "7",
    "sr_method_received_desc" : "Spot311 Interface",
    "sr_closed_date" : "2021-09-27T19:11:51.000",
    "sr_location_x" : "3117089.99834910",
    "sr_status_desc" : "Open",
    "sr_type_desc" : "Park Maintenance - Grounds",
    "sr_location_county" : "TRAVIS",
    "sr_location_map_page" : "525T",
    "sr_location_long" : "-97.73202214",
    "sr_updated_date" : "2021-09-27T18:59:26.000",
    "sr_number" : "21-00441740",
    "sr_location_lat" : "30.34175352",
    "sr_location_lat_long" : {
      "latitude" : "30.34175352",
      "human_address" : "{\"address\": \"\", \"city\": \"\", \"state\": \"\", \"zip\": \"\"}",
      "needs_recoding" : false,
      "longitude" : "-97.73202214"
    },
    "sr_status_date" : "2021-09-27T18:59:26.000",
    "sr_location_street_name" : "VALLEJO",
    "sr_created_date" : "2021-09-27T18:59:26.000",
    "sr_location_street_number" : "1800",
    "sr_location_city" : "AUSTIN",
    "sr_location_y" : "10097624.99943100",
    "sr_location_map_tile" : "MJ28",
    "sr_location_zip_code" : "78757"
  }
  , {
    "sr_location" : "915 MINTURN LN, AUSTIN, TX 78748",
    "sr_location_council_district" : "5",
    "sr_method_received_desc" : "Web",
    "sr_closed_date" : "2021-09-27T19:11:51.000",
    "sr_location_x" : "3095067.00167668",
    "sr_status_desc" : "Open",
    "sr_type_desc" : "Austin Code - Request Code Officer",
    "sr_location_county" : "TRAVIS",
    "sr_location_map_page" : "673L",
    "sr_location_long" : "-97.80614727",
    "sr_updated_date" : "2021-09-27T18:57:33.000",
    "sr_number" : "21-00441737",
    "sr_location_lat" : "30.17792367",
    "sr_location_lat_long" : {
      "latitude" : "30.17792367",
      "human_address" : "{\"address\": \"\", \"city\": \"\", \"state\": \"\", \"zip\": \"\"}",
      "needs_recoding" : false,
      "longitude" : "-97.80614727"
    },
    "sr_status_date" : "2021-09-27T18:57:33.000",
    "sr_location_street_name" : "MINTURN",
    "sr_created_date" : "2021-09-27T18:57:33.000",
    "sr_location_street_number" : "915",
    "sr_location_city" : "AUSTIN",
    "sr_location_y" : "10037518.00190160",
    "sr_location_map_tile" : "MF14",
    "sr_location_zip_code" : "78748"
  }
  , {
    "sr_location" : "8102 FOREST MESA DR, AUSTIN, TX 78759",
    "sr_location_council_district" : "10",
    "sr_method_received_desc" : "E-Mail",
    "sr_closed_date" : "2021-09-27T19:11:52.000",
    "sr_location_x" : "3111472.24680205",
    "sr_status_desc" : "Open",
    "sr_type_desc" : "Tree Issue ROW",
    "sr_location_county" : "TRAVIS",
    "sr_location_map_page" : "495W",
    "sr_location_long" : "-97.74912299",
    "sr_updated_date" : "2021-09-27T18:52:13.000",
    "sr_number" : "21-00441734",
    "sr_location_lat" : "30.36835959",
    "sr_location_lat_long" : {
      "latitude" : "30.36835959",
      "human_address" : "{\"address\": \"\", \"city\": \"\", \"state\": \"\", \"zip\": \"\"}",
      "needs_recoding" : false,
      "longitude" : "-97.74912299"
    },
    "sr_status_date" : "2021-09-27T18:52:13.000",
    "sr_location_street_name" : "FOREST MESA",
    "sr_created_date" : "2021-09-27T18:52:13.000",
    "sr_location_street_number" : "8102",
    "sr_location_city" : "AUSTIN",
    "sr_location_y" : "10107172.99824570",
    "sr_location_map_tile" : "MJ31",
    "sr_location_zip_code" : "78759"
  }
  , {
    "sr_location" : "106 S 1ST ST, AUSTIN, TX 78704",
    "sr_location_council_district" : "9",
    "sr_method_received_desc" : "Spot311 Interface",
    "sr_closed_date" : "2021-09-27T19:11:52.000",
    "sr_location_x" : "3112505.37877724",
    "sr_status_desc" : "New",
    "sr_type_desc" : "AW - Water Waste Report",
    "sr_location_county" : "TRAVIS",
    "sr_location_map_page" : "615A",
    "sr_location_long" : "-97.74870036",
    "sr_updated_date" : "2021-09-27T18:50:23.000",
    "sr_number" : "21-00441731",
    "sr_location_lat" : "30.26185612",
    "sr_location_lat_long" : {
      "latitude" : "30.26185612",
      "human_address" : "{\"address\": \"\", \"city\": \"\", \"state\": \"\", \"zip\": \"\"}",
      "needs_recoding" : false,
      "longitude" : "-97.74870036"
    },
    "sr_status_date" : "2021-09-27T18:50:23.000",
    "sr_location_street_name" : "1ST",
    "sr_created_date" : "2021-09-27T18:50:23.000",
    "sr_location_street_number" : "106",
    "sr_location_city" : "AUSTIN",
    "sr_location_y" : "10068452.35294490",
    "sr_location_map_tile" : "MJ21",
    "sr_location_zip_code" : "78704"
  }
  , {
    "sr_location" : "8112 SEMINARY RIDGE DR, AUSTIN, TX 78745",
    "sr_location_council_district" : "5",
    "sr_method_received_desc" : "Phone",
    "sr_closed_date" : "2021-09-27T19:11:51.000",
    "sr_location_x" : "3089972.25011868",
    "sr_status_desc" : "New",
    "sr_type_desc" : "ARR Brush and Bulk",
    "sr_location_county" : "TRAVIS",
    "sr_location_map_page" : "643X",
    "sr_location_long" : "-97.82181439",
    "sr_updated_date" : "2021-09-27T18:50:10.000",
    "sr_number" : "21-00441730",
    "sr_location_lat" : "30.19563848",
    "sr_location_lat_long" : {
      "latitude" : "30.19563848",
      "human_address" : "{\"address\": \"\", \"city\": \"\", \"state\": \"\", \"zip\": \"\"}",
      "needs_recoding" : false,
      "longitude" : "-97.82181439"
    },
    "sr_status_date" : "2021-09-27T18:50:10.000",
    "sr_location_street_name" : "SEMINARY RIDGE",
    "sr_created_date" : "2021-09-27T18:50:10.000",
    "sr_location_street_number" : "8112",
    "sr_location_city" : "AUSTIN",
    "sr_location_y" : "10043847.00107640",
    "sr_location_map_tile" : "ME16",
    "sr_location_zip_code" : "78745"
  }
  , {
    "sr_location" : "1913 E 17TH ST, AUSTIN, TX 78702",
    "sr_location_council_district" : "1",
    "sr_method_received_desc" : "Phone",
    "sr_closed_date" : "2021-09-27T19:11:51.000",
    "sr_location_x" : "3121525.81758248",
    "sr_status_desc" : "Open",
    "sr_type_desc" : "Dangerous/Vicious Dog Investigation",
    "sr_location_county" : "TRAVIS",
    "sr_location_map_page" : "585Q",
    "sr_location_long" : "-97.71968744",
    "sr_updated_date" : "2021-09-27T18:46:28.000",
    "sr_number" : "21-00441729",
    "sr_location_lat" : "30.27786042",
    "sr_location_lat_long" : {
      "latitude" : "30.27786042",
      "human_address" : "{\"address\": \"\", \"city\": \"\", \"state\": \"\", \"zip\": \"\"}",
      "needs_recoding" : false,
      "longitude" : "-97.71968744"
    },
    "sr_status_date" : "2021-09-27T18:46:28.000",
    "sr_location_street_name" : "17TH",
    "sr_created_date" : "2021-09-27T18:46:28.000",
    "sr_location_street_number" : "1913",
    "sr_location_city" : "AUSTIN",
    "sr_location_y" : "10074485.35057320",
    "sr_location_map_tile" : "MK23",
    "sr_location_zip_code" : "78702"
  }]
var mymap = L.map('mapid').setView([30.2729 , -97.7444], 12.25);

// var change = d3.select("#mapChange")

L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,  
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoicnVsbWEiLCJhIjoiY2tyMWFta3h0MjBneDMxcWh3N2c4djE4YSJ9.oJy_15dF1Y0JoP0x25O15w'
}).addTo(mymap);

var array = [];
// L.marker([30.19563848, -97.82181439], {
//     color: 'red',
//     fillColor: '#f03',
//     fillOpacity: 0.5,
//     radius: 500
//     }).addTo(mymap);


working_data = JSON.parse(window.sessionStorage.getItem('data'))

//function buildMap(data){

    console.log(mymap);
    //console.log(data_displayed);


// change.on("click",buildMap(working_data));

// function buildMap() {
    console.log("list of lat,lng to mark markers at")
    working_data.forEach( (call) => {
            
            
            console.log(call.sr_location_lat, call.sr_location_long);
          
            // lat = parseFloat(call.sr_location_lat) * 1;
            // lng = parseFloat(call.sr_location_long) * 1;
            
            // console.log(`Lat ${lat}`);
            // console.log(`long: ${lng}`);
            // console.log(typeof lat);
        
            // L.marker([lat,lng], {
            //         color: 'red',
            //         fillColor: '#f03',
            //         fillOpacity: 0.5,
            //         radius: 500
            //         }).addTo(mymap);
            
            if (parseFloat(call.sr_location_lat) && parseFloat(call.sr_location_long)){

                    mark = L.marker([parseFloat(call.sr_location_lat), parseFloat(call.sr_location_long)], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 500
                    });

                    //content = L.bindPopup(L.popup({maxWidth:250}).setContent(""))

                    mark.addTo(mymap)
            }
            
        });
// }
//    };



